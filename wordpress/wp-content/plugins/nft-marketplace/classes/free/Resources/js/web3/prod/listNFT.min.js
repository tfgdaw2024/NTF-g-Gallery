let ajaxurl=monft_utility_object.ajax_url,wpNonce=monft_utility_object.wp_nonce,monft_listed_nft_order_ids=monft_utility_object.monft_listed_nft_order_ids,mo_nft_collection=monft_utility_object.mo_nft_collection,monft_signed_nft_listed=monft_utility_object.monft_signed_nft_listed,token_ids=monft_utility_object.token_ids,collection_address=monft_utility_object.collection_address,token_details=monft_utility_object.token_details,marketplace_address=monft_utility_object.marketplace_address,marketplace_abi=monft_utility_object.marketplace_abi,marketplace_address_testnet=monft_utility_object.marketplace_address_testnet,marketplace_abi_testnet=monft_utility_object.marketplace_abi_testnet,marketplace_address_testnet_polygon=monft_utility_object.marketplace_address_testnet_polygon,marketplace_abi_testnet_polygon=monft_utility_object.marketplace_abi_testnet_polygon,marketplace_address_testnet_sepolia=monft_utility_object.marketplace_address_testnet_sepolia,marketplace_abi_testnet_sepolia=monft_utility_object.marketplace_abi_testnet_sepolia,base_url=monft_utility_object.base_url,total_nfts=monft_utility_object.total_nfts,listed_nfts_counter=monft_utility_object.listed_nfts_counter,token_id=monft_utility_object.token_id;const monft_fetch_owner=async(t,e)=>{let n=new Set;for(let a in listing_percentage=0!=total_nfts?Math.ceil(listed_nfts_counter/total_nfts*100):"-",jQuery("#monft_total_NFTs").append(total_nfts),jQuery("#monft_listing_percent").append(listing_percentage+" %"),e)collection_name=a,jQuery("#monft_chain").append(e[a].blockchain);let o;if(null==token_id){for(let i in token_details){let r=e[i.toLowerCase()].blockchain;for(let s in o=getWeb3ContractObject1(JSON.parse(e[i.toLowerCase()].contractABI),i,r),token_details[i]){var c=await o.methods.ownerOf(token_details[i][s]).call();n.add(c),encodedAddress=c.substring(0,5)+"..."+c.substring(c.length-4,c.length),jQuery("#monft-owner-of-nft-"+token_details[i][s]).append("Owned By "+encodedAddress),jQuery("#"+token_details[i][s]+"collection_name").val(collection_address)}}let l=n.size;jQuery("#monft_owner_counter").append(l)}else{for(let d in e)chain=e[d.toLowerCase()].blockchain,TokenABI=e[d.toLowerCase()].contractABI,contractAddress=e[d.toLowerCase()].contractAddress;var c=await (o=getWeb3ContractObject1(JSON.parse(TokenABI),contractAddress,chain)).methods.ownerOf(token_id).call();encodedAddress=c.substring(0,5)+"..."+c.substring(c.length-4,c.length),jQuery("#monft-owner-of-nft-"+token_id).append("Owned By "+encodedAddress),jQuery("#token-owner").attr("name",c)}};function getWeb3ContractObject1(t,e,n){if(window.ethereum){let a=new Web3(window.ethereum),o=new a.eth.Contract(t,e);return"Goerli"==n?o.setProvider("https://eth-goerli.g.alchemy.com/v2/tFjIT7EBJE21wbRVNXJ4nk464t_hNtIt"):"Ethereum-Mainnet"==n?o.setProvider("https://eth.llamarpc.com"):"Polygon"==n||"mumbai"==n?o.setProvider("https://polygon-mumbai-pokt.nodies.app"):"Goerli"==n?o.setProvider("https://web3-trial.cloudflare-eth.com/v1/goerli"):"sepolia"==n?o.setProvider("https://eth-sepolia.g.alchemy.com/v2/g5TxwTxkPhEZu4jMAB4OFYnhGH4oi2hC"):o.setProvider("https://polygon-rpc.com/"),o}}const monft_fetch_list_price=async(t,e)=>{for(let n in e)collection_name=n;if(void 0===token_details)for(let a in token_details){var o=a,i=e[a].contractABI;let r=e[a].blockchain,s=e[a].customTokenName,c=[];c=getChainDetails(r,s);let l=new _ethers.providers.Web3Provider(window.ethereum);for(let d in await l.send("eth_requestAccounts",[]),l.getSigner(),token_details[a]){let m=-1;""!==monft_listed_nft_order_ids[token_details[a][d]]&&void 0!==monft_listed_nft_order_ids[token_details[a][d]]&&(m=_ethers.utils.formatEther(monft_listed_nft_order_ids[token_details[a][d]])),_ethers.utils.formatEther(0)!==m&&-1!==m&&jQuery("#monft-is-listed-message-"+token_details[a][d]).text("Price: "+m+" "+c.chainSymbol),m=-1}}};function getChainDetails(t,e){let n=[];switch(n.chainSymbol=e,t){case"Polygon":case"mumbai":e||(n.chainSymbol="MATIC"),n.name="Mumbai Testnet",n.chainId=_ethers.utils.hexValue(80001),n.url="https://polygon-mumbai.g.alchemy.com/v2/cp_ROOTPfVxPFkH4qJmKZMPfWnuUZWg7",n.currName="Matic",n.blockUrl="https://mumbai.polygonscan.com/",n.marketplace_address=marketplace_address_testnet_polygon,n.marketplace_abi=marketplace_abi_testnet_polygon;break;case"Goerli":e||(n.chainSymbol="ETH"),n.name="Goerli Testnet",n.chainId=_ethers.utils.hexValue(5),n.url="https://eth-goerli.g.alchemy.com/v2/O9TvFMdLZ2_fJTBbChS9mz0RB5We_EJ_",n.currName="Ether",n.blockUrl="https://goerli.etherscan.io/",n.marketplace_address=marketplace_address_testnet,n.marketplace_abi=marketplace_abi_testnet;break;case"sepolia":e||(n.chainSymbol="ETH"),n.name="Sepolia test network",n.chainId=_ethers.utils.hexValue(11155111),n.url="https://eth-sepolia.g.alchemy.com/v2/g5TxwTxkPhEZu4jMAB4OFYnhGH4oi2hC",n.currName="Ether",n.blockUrl="https://sepolia.etherscan.io",n.marketplace_address=marketplace_address_testnet_sepolia,n.marketplace_abi=marketplace_abi_testnet_sepolia;break;case"Ethereum-Mainnet":e||(n.chainSymbol="ETH"),n.name="Ethereum Mainnet",n.chainId=_ethers.utils.hexValue(1),n.url="https://eth.llamarpc.com",n.currName="ETH",n.blockUrl="https://etherscan.io/",n.marketplace_address=marketplace_address,n.marketplace_abi=marketplace_abi;break;case"Binance":e||(n.chainSymbol="BNB"),n.name="Binance Testnet",n.chainId=_ethers.utils.hexValue(97),n.url="https://data-seed-prebsc-1-s2.binance.org:8545",n.currName="BNB",ChainDetials.blockUrl="https://testnet.bscscan.com/"}return n}jQuery(document).ready(async function(){let t=async()=>{await connectWallet(jQuery("#monft-mp-connect-wallet"))};jQuery("#monft-mp-connect-wallet").click(t),jQuery('button[name="mint-button"]').click(async function(){if("yes"===jQuery(this).attr("minted")){jQuery(this).attr("minted");return}if("no"===jQuery(this).attr("listed"))return;let t=jQuery(this).attr("id");jQuery('img[name="monft-buying-loader-'+t+'"]').show(),jQuery('svg[name="monft-cart-svg-'+t+'"]').hide(),jQuery('p[name="monft-mint-text-'+t+'"]').hide(),jQuery("#monft-grid-info-panel-"+t).css({opacity:"0.7"}),jQuery(this).css({bottom:"10%",opacity:"1"});let e=jQuery(this),n=jQuery("#monft_image_"+t);await jQuery.post(ajaxurl,{action:"monft_mint_nft",request:"monft_mint",monft_postId:t,mo_nft_verify_nonce:wpNonce},async function(a){let o=JSON.parse(a),i=o.cid;collection_name=o.collection_name,await window.ethereum.request({method:"eth_requestAccounts"}),window.web3=new Web3(window.ethereum);let r=web3.eth.accounts,s=r.givenProvider.selectedAddress;try{decodedResToken=await mintNFTPremium(t,s,i,mo_nft_collection,collection_name)}catch(c){try{await jQuery.post(ajaxurl,{action:"monft_api_minting_product",request:"monft_api_mint",monft_postId:t,wallet_id:s,token_uri:i,mo_nft_verify_nonce:wpNonce},async function(a){a.status&&(jQuery('img[name="monft-buying-loader-'+t+'"]').hide(),jQuery(e).text("#"+t+" Minted!"),jQuery("#monft-grid-info-panel-"+t).css({opacity:""}),jQuery(e).css({bottom:"",opacity:""}),jQuery(e).attr("minted","yes"),jQuery(n).attr("minted","yes"))})}catch(l){throw l}}})}),jQuery('button[name="buy-button"]').click(async function(){if("no"===jQuery(this).attr("listed"))return;let t=jQuery(this).attr("id"),e;if(jQuery("#owner-address-"+t).attr("name")===await getWalletAddress()){jQuery(this).text("Owned by you");return}let n,a=jQuery(this).attr("value");jQuery('img[name="monft-buying-loader-'+t+'"]').show(),jQuery('svg[name="monft-cart-svg-'+t+'"]').hide(),jQuery('p[name="monft-buy-text-'+t+'"]').hide(),jQuery("#monft-grid-info-panel-"+t).css({opacity:"0.7"}),jQuery(this).css({bottom:"10%",opacity:"1"}),await jQuery.post(ajaxurl,{action:"monft_get_listed_voucher",tokenId:t,mo_nft_verify_nonce:wpNonce},async function(t){signature=(voucher=t)[0].Signature;let e=voucher[0].message,a=voucher[0].Price,o=voucher[0].Token_Id,i=voucher[0].nonce,r=voucher[0].Nft_Contract;listVoucher={price:a,tokenId:o,collectionAddress:r,nonce:i,message:e},n=_ethers.utils.splitSignature(signature)});try{var o=await buyNft(t,"1",mo_nft_collection,a,listVoucher,n.v,n.r,n.s);await jQuery.post(ajaxurl,{action:"monft_moralis_get_data",request:"monft_save_owner_after_buy",txHash:o.hash,tokenId:t,mo_nft_verify_nonce:wpNonce}),await jQuery.post(ajaxurl,{action:"monft_after_buy_wc_product",request:"monft_list",txHash:o.hash,postId:t,mo_nft_verify_nonce:wpNonce},async function(t){JSON.parse(t)}),jQuery('img[name="monft-buying-loader-'+t+'"]').hide(),jQuery(this).text("#"+t+" Sold!"),jQuery("#monft-grid-info-panel-"+t).css({opacity:""}),jQuery(this).css({bottom:"",opacity:""}),jQuery(this).attr("listed","no"),jQuery("#monft-not-listed-message-"+t).text("#"+t+" is not listed")}catch(i){throw jQuery('img[name="monft-buying-loader-'+t+'"]').hide(),jQuery('svg[name="monft-cart-svg-'+t+'"]').show(),jQuery('p[name="monft-buy-text-'+t+'"]').show(),jQuery("#monft-grid-info-panel-"+t).css({opacity:""}),(i.code=-32e3===i.data.code)?(jQuery("#owner-address-"+t).text("Insufficient funds.").show(),jQuery("#owner-address-"+t).css({textAlign:"center",fontSize:"14px"})):4001===i.code?(jQuery("#owner-address-"+t).text("Transaction rejected.").show(),jQuery("#owner-address-"+t).css({textAlign:"center",fontSize:"14px"})):(jQuery("#owner-address-"+t).text("Some error occured.").show(),jQuery("#owner-address-"+t).css({textAlign:"center",fontSize:"14px"})),jQuery(this).css({bottom:"",opacity:""}),i}})}),jQuery('button[name="list-nft-button"]').click(function(){let t=jQuery(this).attr("id");var e=window.location.href,n=`nft-details?tokenId=${t}`;window.location.href=e+n}),jQuery(".monft-image-wrapper-minted").click(function(){let t=jQuery(this).attr("id");var e=window.location.href,n=`nft-details?tokenId=${t}`;window.location.href=e+n}),jQuery(".monft-image-wrapper-not-minted").click(function(){let t=jQuery(this).attr("id");var e=window.location.href;let n=jQuery("#monft_image_"+t);if("yes"===jQuery(n).attr("minted"))var a=`nft-details?tokenId=${t}`;else var a=`nft-details?productId=${t}`;window.location.href=e+a});var tabs=jQuery(".right-section-tabs .tab"),tabContents=jQuery(".right-section-bottom .tab-content");async function switchNetwork(t){await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:getChainDetails(t).chainId}]}).then(()=>{}).catch(e=>{if(console.log("From inside catch!",t),4902===e.code){let n,a,o,i,r,s,c=getChainDetails(t);n=c.chainId,a=c.name,o=c.currName,i=c.chainSymbol,addChain(n,a,o,i,r=c.url,s=c.blockUrl)}else if(4001===e.code)throw"User rejected switching Network!"})}jQuery("#details-tab").addClass("active").click(),jQuery("#details-content").show(),tabs.on("click",function(){tabs.removeClass("active"),jQuery(this).addClass("active"),tabContents.hide();var t=jQuery(this).attr("id").replace("-tab","");jQuery("#"+t+"-content").show()}),jQuery(document).on("click",function(t){jQuery(t.target).closest("#myModal").length||jQuery("#myModal").hide()}),jQuery('button[name="monft-list-button-from-profile"]').click(async function(){let t=jQuery(this).attr("id");var e=document.getElementById(t).value;if(e){if(e<=0){alert("Please the Enter the Listing price greater that zero");return}}else{alert("Please the Enter the Listing price");return}let n=await getWalletAddress(),a=jQuery("#token-owner").attr("name");if(n!==a.toLowerCase()){jQuery("#list-button-text").text("You are not the owner of NFT"),jQuery("#"+t).hide();return}let o=jQuery(this).val();jQuery("#loaderwholescreen").show();try{e=await _ethers.utils.parseEther(e)}catch(i){console.log(i)}var r=mo_nft_collection[o].contractAddress,s=mo_nft_collection[o].contractABI;let c=mo_nft_collection[o].blockchain,l=mo_nft_collection[o].customTokenName,d=[];d=getChainDetails(c,l);try{await ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:d.chainId}]})}catch(m){if(4902===m.code)try{await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:d.chainId,rpcUrls:[d.url],chainName:d.name,nativeCurrency:{name:d.currName,symbol:d.currName,decimals:18},blockExplorerUrls:[ChainDetials.blockUrl]},]})}catch(h){console.log(h)}}let u=new _ethers.Contract(r,s),f=new _ethers.providers.Web3Provider(window.ethereum),p=f.getSigner();try{await u.connect(p).approve(d.marketplace_address,t)}catch(w){throw 4001===w.code&&jQuery("#loaderwholescreen").hide(),w}msg="Price: "+e+", Token Id: "+t+", NFT Contract: "+r+", nonce: "+wpNonce;try{signature=await p.signMessage(msg)}catch(b){4001===b.code&&jQuery("#loaderwholescreen").hide(),console.log(b)}if(""!==signature)try{let g;await jQuery.post(ajaxurl,{action:"monft_signed_list_wc_product",request:"monft_signed_list",signedData:{Price:e._hex,Token_Id:t,Nft_Contract:r,nonce:wpNonce,message:msg,Signature:signature},mo_nft_verify_nonce:wpNonce},function(t){t.status?(jQuery("#loaderwholescreen").hide(),jQuery("#myModal").show(),jQuery("#myModal p").text("You have successfully Listed the NFT"),setTimeout(function(){window.location.reload()},3e3)):(jQuery("#loaderwholescreen").hide(),jQuery("#list-button-text").text("Not able to list"))})}catch(y){jQuery("#loaderwholescreen").hide(),console.log(y)}}),jQuery("#modalOKBtn").on("click",function(){jQuery("#myModal").hide()}),jQuery('button[name="monft-mint-button-from-profile"]').click(async function(){let t=jQuery(this).attr("id");jQuery("#loaderwholescreen").show(),await jQuery.post(ajaxurl,{action:"monft_mint_nft",request:"monft_mint",monft_postId:t,mo_nft_verify_nonce:wpNonce},async function(e){let n=JSON.parse(e),a=n.cid;collection_name=n.collection_name,await window.ethereum.request({method:"eth_requestAccounts"}),window.web3=new Web3(window.ethereum);let o=web3.eth.accounts,i=o.givenProvider.selectedAddress;try{decodedResToken=await mintNFTPremium(t,i,a,mo_nft_collection,collection_name)}catch(r){try{await jQuery.post(ajaxurl,{action:"monft_api_minting_product",request:"monft_api_mint",monft_postId:t,wallet_id:i,token_uri:a,mo_nft_verify_nonce:wpNonce},async function(e){if(e.status){jQuery("#loaderwholescreen").hide(),jQuery("#myModal").show(),jQuery("#myModal p").text("You have successfully minted the NFT");var n=window.location.href.split("?")[0],a=`?tokenId=${t}`,o=n+a;setTimeout(function(){window.location.href=o},3e3)}else jQuery("#loaderwholescreen").hide(),jQuery("#buy-button-text").text("Not able to mint")})}catch(s){throw jQuery("#loaderwholescreen").hide(),4001===s.code?(jQuery("#buy-button-text").text("Transaction rejected.").show(),jQuery("#buy-button-text").css({textAlign:"center",fontSize:"14px"})):(jQuery("#buy-button-text").text("Some error occured.").show(),jQuery("#buy-button-text").css({textAlign:"center",fontSize:"14px"})),s}}})}),jQuery('button[name="monft-buy-button-from-profile"]').click(async function(){let t,e=jQuery(this).attr("id"),n=jQuery(this).attr("value");jQuery("#loaderwholescreen").show();let a=await getWalletAddress();a||(a=await connectWalletIfNotConnected());let o=jQuery("#token-owner").attr("name");if(a===o){jQuery("#buy-button-text").text("You are the owner of NFT"),jQuery("#"+e).hide(),jQuery("#loaderwholescreen").hide();return}await jQuery.post(ajaxurl,{action:"monft_get_listed_voucher",tokenId:e,mo_nft_verify_nonce:wpNonce},async function(e){signature=(voucher=e)[0].Signature;let n=voucher[0].message,a=voucher[0].Price,o=voucher[0].Token_Id,i=voucher[0].nonce,r=voucher[0].Nft_Contract;listVoucher={price:a,tokenId:o,collectionAddress:r,nonce:i,message:n},t=_ethers.utils.splitSignature(signature)});try{var i=await buyNft(e,"1",mo_nft_collection,n,listVoucher,t.v,t.r,t.s);await jQuery.post(ajaxurl,{action:"monft_moralis_get_data",request:"monft_save_owner_after_buy",txHash:i.hash,tokenId:e,mo_nft_verify_nonce:wpNonce}),await jQuery.post(ajaxurl,{action:"monft_after_buy_wc_product",request:"monft_list",txHash:i.hash,postId:e,mo_nft_verify_nonce:wpNonce},async function(t){JSON.parse(t)}),jQuery("#loaderwholescreen").hide(),jQuery("#myModal").show(),jQuery("#myModal p").text("You have successfully bought the NFT"),setTimeout(function(){window.location.reload()},3e3)}catch(r){throw jQuery("#loaderwholescreen").hide(),(r.code=-32e3===r.data.code)?(jQuery("#buy-button-text").text("Insufficient funds.").show(),jQuery("#buy-button-text").css({textAlign:"center",fontSize:"14px",marginTop:"-15px"})):4001===r.code?(jQuery("#buy-button-text").text("Transaction rejected.").show(),jQuery("#buy-button-text").css({textAlign:"center",fontSize:"14px",marginTop:"-15px"})):(jQuery("#buy-button-text").text("Some error occured.").show(),jQuery("#buy-button-text").css({textAlign:"center",fontSize:"14px",marginTop:"-15px"})),jQuery("#"+e).show(),r}});const connectWallet=async t=>{void 0!==window.ethereum?window.ethereum.request({method:"eth_requestAccounts"}).then(e=>{let n=e[0];t.text("Wallet connected: "+n.substring(0,5)+"...."+n.substring(37,42))}).catch(t=>{console.log(t,t.code)}):window.open("https://metamask.io/download/","_blank")},getWalletAddress=async()=>{if(void 0!==window.ethereum)return window.ethereum.request({method:"eth_accounts"}).then(t=>{let e=t[0];return e}).catch(t=>{console.log(t,t.code)})},connectWalletIfNotConnected=async()=>{if(void 0!==window.ethereum)return window.ethereum.request({method:"eth_requestAccounts"}).then(t=>{let e=t[0];return e}).catch(t=>{console.log(t,t.code)});window.open("https://metamask.io/download/","_blank")},buyNft=async(t,e,n,a,o,i,r,s)=>{let c=n[a.toLowerCase()].blockchain,l=n[a.toLowerCase()].customTokenName,d=[];d=getChainDetails(c,l);let m=new _ethers.Contract(d.marketplace_address,d.marketplace_abi);try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:d.chainId}]})}catch(h){if(4902===h.code)try{await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:d.chainId,rpcUrls:[d.url],chainName:d.name,nativeCurrency:{name:d.currName,symbol:d.currName,decimals:18},blockExplorerUrls:[ChainDetials.blockUrl]},]})}catch(u){console.log(u)}}let f=new _ethers.providers.Web3Provider(window.ethereum),p=f.getSigner();if(""!==l&&void 0!==l)buyNftPremium(m,n,a);else try{let w=await m.connect(p).buyUsingSignedListing(o,i,r,s,{value:o.price});return await w.wait(1),w}catch(b){throw 4001===b.code&&jQuery('img[name="buying_loader_'+t+'"]').hide(),b}},searchNft=async(t,e)=>{let n=t.val().trim().toLowerCase();e.each(function(){let t=jQuery(this).find(".monft-item-name").text().toLowerCase();t.includes(n)?jQuery(this).show():jQuery(this).hide()})};